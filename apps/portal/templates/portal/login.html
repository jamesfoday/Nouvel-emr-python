{% extends "base.html" %}
{% load static %}

{% block title %}Sign in · Nouvel Portal{% endblock %}

{% block appbar_right %}
  {% if not request.user.is_authenticated %}
    <a href="{% url 'login' %}"
       class="inline-flex items-center rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1.5 text-sm font-medium shadow-sm">
      Sign in
    </a>
  {% endif %}
{% endblock %}

{% block content %}
<div class="min-h-[calc(100dvh-8rem)] w-full flex items-center justify-center px-4">
  <div class="w-full max-w-md">
    <div class="text-center mb-6">
      <a href="/portal/" class="inline-flex items-baseline gap-2 text-gray-900 no-underline">
        <span class="text-2xl font-extrabold">Nouvel</span>
        <span class="text-gray-500">Portal</span>
      </a>
      <p class="mt-2 text-gray-600">Sign in with your <strong>email</strong> or <strong>phone</strong>.</p>
    </div>

    {% if messages %}
      <div class="space-y-2 mb-4">
        {% for message in messages %}
          <div class="rounded-xl px-4 py-3 text-sm
            {% if message.tags == 'success' %} bg-emerald-50 text-emerald-700
            {% elif message.tags == 'error' %} bg-rose-50 text-rose-700
            {% else %} bg-slate-50 text-slate-700 {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-6">
   <form method="post" action="{% url 'login' %}" class="space-y-4">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ next|default:'' }}">
      <input type="hidden" name="audience" id="login-audience" value="auto">

      <div>
        <label for="id_username" class="block text-sm font-medium text-emerald-900 mb-1">Email</label>
        <input type="text" name="username" id="id_username"
              class="w-full px-3 py-2 border rounded-lg focus:ring-emerald-500 focus:border-emerald-500"
              required>
      </div>

      <div>
        <label for="id_password" class="block text-sm font-medium text-emerald-900 mb-1">Password</label>
        <input type="password" name="password" id="id_password"
              class="w-full px-3 py-2 border rounded-lg focus:ring-emerald-500 focus:border-emerald-500"
              required>
      </div>

      <div class="flex justify-between items-center">
        <div class="flex items-center gap-2">
          <input type="checkbox" name="remember" id="id_remember">
          <label for="id_remember" class="text-sm text-emerald-900/80">Remember me</label>
        </div>
        <a href="{% url 'password_reset' %}" class="text-sm text-emerald-700 hover:underline">
          Forgot password?
        </a>
      </div>

      <button type="submit"
              class="w-full py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl transition active:scale-[.98]">
        Sign In
      </button>
</form>


    <div class="mt-4 text-center text-sm text-gray-600">
        Don’t have an account?
        <a href="/portal/signup/" class="text-emerald-700 hover:underline">Create one</a>
      </div>
    </div>
  </div>
</div>

<script>
  
  document.querySelectorAll('[data-login-role]').forEach(btn => {
    btn.addEventListener('click', e => {
      document.getElementById('login-audience').value = e.target.dataset.loginRole;
    });
  });
</script>
{% endblock %}
