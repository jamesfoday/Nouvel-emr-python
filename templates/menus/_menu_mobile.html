{# templates/menus/_mobile_menu.html
   expects: menu_items (top-level items) and request
#}
{% load menus_tags %}

<div id="mobile-menu"
     class="fixed inset-0 z-[60] hidden"
     aria-hidden="true">

  {# Dim overlay ----------------------------------------------------------- #}
  <div class="absolute inset-0 bg-black/40"
       data-close-mobile></div>

  {# Drawer --------------------------------------------------------------- #}
  <aside
    class="absolute right-0 top-0 h-full w-[84vw] max-w-[420px]
           bg-white shadow-xl border-l border-black/10
           overflow-y-auto overflow-x-hidden
           pt-[env(safe-area-inset-top,0)] pb-[calc(env(safe-area-inset-bottom,0)+1rem)]">

    {# Sticky header #}
    <div class="sticky top-0 z-10 bg-white/95 backdrop-blur border-b border-black/10 px-4 py-3">
      <div class="flex items-center justify-between">
        <h2 class="text-base font-semibold">Menu</h2>
        <button type="button"
                class="h-9 w-9 grid place-items-center rounded-lg
                       border border-black/10 hover:bg-slate-50"
                aria-label="Close"
                data-close-mobile>âœ•</button>
      </div>
    </div>

    {# Content ------------------------------------------------------------- #}
    <div class="px-4 py-4 space-y-5">

      {% for item in menu_items %}
        {% with kids=item.children.all|dictsort:'order' %}
          <section class="space-y-2">

            {# Top-level label (acts like a section title) #}
            <h3 class="text-sm font-semibold text-slate-900
                       break-words whitespace-normal hyphens-auto">
              {{ item.label }}
            </h3>

            <ul class="space-y-1">
              {# Children as flat list #}
              {% for c in kids %}
                {% if c.is_active and c|can_see:request.user %}
                  {% menu_href c as chref %}
                  <li>
                    <a href="{{ chref }}"
                       {% if c.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}
                       class="block rounded-xl border border-black/10 px-3 py-2
                              text-slate-800 text-[15px] leading-snug
                              hover:border-[#24B2C1]/30 hover:bg-slate-50 transition
                              break-words whitespace-normal hyphens-auto">
                      {{ c.label }}
                    </a>
                  </li>
                {% endif %}
              {% empty %}
                {# If no children, fall back to linking the parent (when it has a URL) #}
                {% if item.url_kind != 'none' %}
                  {% menu_href item as chref %}
                  <li>
                    <a href="{{ chref }}"
                       {% if item.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}
                       class="block rounded-xl border border-black/10 px-3 py-2
                              text-slate-800 text-[15px] leading-snug
                              hover:border-[#24B2C1]/30 hover:bg-slate-50 transition
                              break-words whitespace-normal hyphens-auto">
                      {{ item.label }}
                    </a>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          </section>
        {% endwith %}
      {% endfor %}

    </div>
  </aside>
</div>
