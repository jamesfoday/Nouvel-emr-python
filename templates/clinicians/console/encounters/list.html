{% extends "base.html" %}
{% block content %}
<div class="mx-auto mt-6 w-full max-w-5xl px-3 sm:px-6">
  <div class="rounded-3xl bg-[#CFE8D6]/70 p-1">
    <div class="rounded-3xl bg-white/70 backdrop-blur p-5 sm:p-7 shadow-xl">

      <!-- Header (unchanged) -->
      <div class="mb-4 flex items-center justify-between">
        <a href="{% url 'encounters_ui:create' pk=clinician.pk %}"
           class="inline-flex items-center gap-2 rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:brightness-95">
          <span class="grid h-5 w-5 place-items-center rounded-full bg-white/20 text-white">+</span>
          Create
        </a>
        <h1 class="text-lg sm:text-xl font-semibold text-gray-800">Encounters</h1>
        <div class="w-28"></div>
      </div>

      <!-- Search + Status filters -->
      <div class="mb-5 grid gap-3 sm:grid-cols-3">
        <!-- search -->
        <form method="get" class="sm:col-span-2">
          <div class="relative rounded-2xl bg-white/80 ring-1 ring-gray-200">
            <input
              type="text"
              name="q"
              value="{{ q }}"
              placeholder="Search encounters"
              class="w-full rounded-2xl bg-transparent px-4 py-3 pr-10 text-sm text-gray-800 focus:outline-none"
            >
            <input type="hidden" name="status" value="{{ status|default:'open' }}">
            <svg class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none">
              <path d="M21 21l-4.3-4.3m1.3-5.2a6.5 6.5 0 11-13 0 6.5 6.5 0 0113 0z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
        </form>

        <!-- status pills -->
        {% with s=status|default:'open' %}
        <div class="flex flex-wrap items-center gap-2 justify-start sm:justify-end">
          <a href="{% url 'encounters_ui:list' pk=clinician.pk %}?status=all{% if q %}&q={{ q|urlencode }}{% endif %}"
             class="rounded-full px-3 py-1.5 text-sm border transition
                    {% if s == 'all' %} bg-emerald-600 text-white border-emerald-600
                    {% else %} bg-white text-gray-700 border-gray-200 hover:border-gray-300 {% endif %}">
            All
          </a>
          <a href="{% url 'encounters_ui:list' pk=clinician.pk %}?status=open{% if q %}&q={{ q|urlencode }}{% endif %}"
             class="rounded-full px-3 py-1.5 text-sm border transition
                    {% if s == 'open' %} bg-emerald-600 text-white border-emerald-600
                    {% else %} bg-white text-gray-700 border-gray-200 hover:border-gray-300 {% endif %}">
            Open
          </a>
          <a href="{% url 'encounters_ui:list' pk=clinician.pk %}?status=closed{% if q %}&q={{ q|urlencode }}{% endif %}"
             class="rounded-full px-3 py-1.5 text-sm border transition
                    {% if s == 'closed' %} bg-emerald-600 text-white border-emerald-600
                    {% else %} bg-white text-gray-700 border-gray-200 hover:border-gray-300 {% endif %}">
            Closed
          </a>
          <a href="{% url 'encounters_ui:list' pk=clinician.pk %}?status=cancelled{% if q %}&q={{ q|urlencode }}{% endif %}"
             class="rounded-full px-3 py-1.5 text-sm border transition
                    {% if s == 'cancelled' %} bg-emerald-600 text-white border-emerald-600
                    {% else %} bg-white text-gray-700 border-gray-200 hover:border-gray-300 {% endif %}">
            Cancelled
          </a>
        </div>
        {% endwith %}
      </div>

      <!-- List body (unchanged structure; just styled) -->
      <div class="rounded-3xl bg-[#EEF7F0] min-h-[420px] p-4 sm:p-6">
        <div class="space-y-4">
          {% for e in encounters %}
            <a href="{% url 'encounters_ui:view' pk=clinician.pk eid=e.pk %}"
               class="block rounded-3xl bg-white/70 ring-1 ring-black/5 px-5 py-4 shadow-sm hover:shadow transition">
              <div class="flex items-start justify-between gap-4">
                <div class="min-w-0">
                  <div class="font-semibold text-gray-900 truncate">
                    {{ e.patient.full_name }} · {{ e.reason|default:"Encounter" }}
                  </div>
                  <div class="mt-0.5 text-sm text-gray-600 truncate">
                    {{ e.start|date:"d M Y, H:i" }}{% if e.location %} · {{ e.location }}{% endif %}
                  </div>
                </div>
                <span class="shrink-0 rounded-full px-3 py-1 text-xs font-semibold
                            {% if e.status == 'open' %} bg-emerald-100 text-emerald-800
                            {% elif e.status == 'closed' %} bg-gray-200 text-gray-800
                            {% else %} bg-amber-100 text-amber-800 {% endif %}">
                  {{ e.get_status_display }}
                </span>
              </div>
            </a>
          {% empty %}
            <div class="rounded-3xl bg-white/60 ring-1 ring-black/5 px-6 py-16 text-center text-gray-500 shadow-sm">
              No encounters yet.
              <div class="mt-3">
                <a href="{% url 'encounters_ui:create' pk=clinician.pk %}"
                   class="inline-flex items-center gap-2 rounded-full bg-gray-900 px-4 py-2 text-sm font-semibold text-white">
                  + Create
                </a>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- Back button (unchanged) -->
      <div class="mt-8">
        <a href="{% url 'clinicians_ui:dashboard' pk=clinician.pk %}"
           class="inline-flex items-center gap-2 rounded-full bg-gray-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:brightness-95">
          <span class="grid h-5 w-5 place-items-center rounded-full bg-white/20 text-white">&lsaquo;</span>
          Back
        </a>
      </div>

    </div>
  </div>
</div>
{% endblock %}
