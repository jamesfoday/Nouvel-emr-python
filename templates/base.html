<!doctype html>
{% load static rbac_tags %}
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Nouvel Console{% endblock %}</title>

    <!-- App styles (our lightweight design system) -->
    <link rel="stylesheet" href="{% static 'css/app.css' %}" />

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.3"></script>

    <!-- CSRF token for HTMX/XHR -->
    <meta name="csrf-token" content="{{ csrf_token }}">
    <script>
      document.addEventListener('htmx:configRequest', (e) => {
        const token = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
        if (token) e.detail.headers['X-CSRFToken'] = token;
      });
    </script>

    {% block head %}{% endblock %}
  </head>
  <body>
    <!-- Top navigation -->
    <header class="nav card">
      <div class="container" style="display:flex;justify-content:space-between;align-items:center;">
        <div style="display:flex;gap:10px;align-items:center;">
          <a href="/console/" class="brand" style="font-weight:700;text-decoration:none;">Nouvel</a>
          <span class="muted">Console</span>
        </div>
        <nav style="display:flex;gap:10px;align-items:center;">
          <a href="/console/patients/">Patients</a>
          <a href="/console/appointments/">Appointments</a>
          {% if request.user|in_roles:"admin" %}<a href="/admin/">Admin</a>{% endif %}
          <a href="/api/docs/">API</a>
          <span id="busy-indicator" class="htmx-indicator"><span class="spinner"></span>&nbsp;Loadingâ€¦</span>
        </nav>
      </div>
    </header>

    <!-- Page content -->
    <main class="container">
      {% block content %}{% endblock %}
    </main>

    <!-- Modal root (HTMX partials can target this) -->
    <div id="modal" class="modal-root" aria-live="polite" aria-atomic="true"></div>

    <!-- App scripts -->
    <script defer src="{% static 'js/console.js' %}"></script>
    {% block scripts %}{% endblock %}
  </body>
</html>
